<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/smartracket/com/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/smartracket/com/MainActivity.kt" />
              <option name="originalContent" value="package smartracket.com&#10;&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.NavGraph.Companion.findStartDestination&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import dagger.hilt.android.AndroidEntryPoint&#10;import smartracket.com.ui.screens.*&#10;import smartracket.com.ui.theme.SmartRacketTheme&#10;&#10;/**&#10; * Main entry point for SmartRacket Coach app.&#10; *&#10; * Sets up:&#10; * - Jetpack Compose UI with Material 3&#10; * - Navigation with bottom navigation bar&#10; * - Hilt dependency injection&#10; */&#10;@AndroidEntryPoint&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;        setContent {&#10;            SmartRacketTheme {&#10;                SmartRacketApp()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Navigation routes for the app.&#10; */&#10;sealed class Screen(val route: String, val title: String, val icon: ImageVector) {&#10;    data object Home : Screen(&quot;home&quot;, &quot;Home&quot;, Icons.Default.Home)&#10;    data object Training : Screen(&quot;training&quot;, &quot;Training&quot;, Icons.Default.FitnessCenter)&#10;    data object Analytics : Screen(&quot;analytics&quot;, &quot;Analytics&quot;, Icons.Default.Analytics)&#10;    data object Highlights : Screen(&quot;highlights&quot;, &quot;Highlights&quot;, Icons.Default.Stars)&#10;    data object Settings : Screen(&quot;settings&quot;, &quot;Settings&quot;, Icons.Default.Settings)&#10;}&#10;&#10;/**&#10; * Main app composable with navigation setup.&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun SmartRacketApp() {&#10;    val navController = rememberNavController()&#10;&#10;    val bottomNavItems = listOf(&#10;        Screen.Home,&#10;        Screen.Training,&#10;        Screen.Analytics,&#10;        Screen.Highlights,&#10;        Screen.Settings&#10;    )&#10;&#10;    Scaffold(&#10;        modifier = Modifier.fillMaxSize(),&#10;        bottomBar = {&#10;            NavigationBar {&#10;                val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;                val currentDestination = navBackStackEntry?.destination&#10;&#10;                bottomNavItems.forEach { screen -&gt;&#10;                    NavigationBarItem(&#10;                        icon = { Icon(screen.icon, contentDescription = screen.title) },&#10;                        label = { Text(screen.title) },&#10;                        selected = currentDestination?.hierarchy?.any { it.route == screen.route } == true,&#10;                        onClick = {&#10;                            navController.navigate(screen.route) {&#10;                                // Pop up to the start destination of the graph to&#10;                                // avoid building up a large stack of destinations&#10;                                popUpTo(navController.graph.findStartDestination().id) {&#10;                                    saveState = true&#10;                                }&#10;                                // Avoid multiple copies of the same destination&#10;                                launchSingleTop = true&#10;                                // Restore state when reselecting a previously selected item&#10;                                restoreState = true&#10;                            }&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    ) { innerPadding -&gt;&#10;        NavHost(&#10;            navController = navController,&#10;            startDestination = Screen.Home.route,&#10;            modifier = Modifier.padding(innerPadding)&#10;        ) {&#10;            composable(Screen.Home.route) {&#10;                HomeScreen(&#10;                    onStartTraining = {&#10;                        navController.navigate(Screen.Training.route)&#10;                    },&#10;                    onViewAnalytics = {&#10;                        navController.navigate(Screen.Analytics.route)&#10;                    },&#10;                    onViewHighlights = {&#10;                        navController.navigate(Screen.Highlights.route)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Training.route) {&#10;                TrainingScreen(&#10;                    onNavigateBack = {&#10;                        navController.navigate(Screen.Home.route) {&#10;                            popUpTo(Screen.Home.route) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Analytics.route) {&#10;                AnalyticsScreen()&#10;            }&#10;&#10;            composable(Screen.Highlights.route) {&#10;                HighlightsScreen()&#10;            }&#10;&#10;            composable(Screen.Settings.route) {&#10;                SettingsScreen()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package smartracket.com&#10;&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.NavGraph.Companion.findStartDestination&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import dagger.hilt.android.AndroidEntryPoint&#10;import smartracket.com.ui.screens.*&#10;import smartracket.com.ui.theme.SmartRacketTheme&#10;&#10;/**&#10; * Main entry point for SmartRacket Coach app.&#10; *&#10; * Sets up:&#10; * - Jetpack Compose UI with Material 3&#10; * - Navigation with bottom navigation bar&#10; * - Hilt dependency injection&#10; */&#10;@AndroidEntryPoint&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;        setContent {&#10;            SmartRacketTheme {&#10;                SmartRacketApp()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Navigation routes for the app.&#10; */&#10;sealed class Screen(val route: String, val title: String, val icon: ImageVector) {&#10;    data object Home : Screen(&quot;home&quot;, &quot;Home&quot;, Icons.Default.Home)&#10;    data object Training : Screen(&quot;training&quot;, &quot;Training&quot;, Icons.Default.FitnessCenter)&#10;    data object Analytics : Screen(&quot;analytics&quot;, &quot;Analytics&quot;, Icons.Default.Analytics)&#10;    data object Highlights : Screen(&quot;highlights&quot;, &quot;Highlights&quot;, Icons.Default.Stars)&#10;    data object Settings : Screen(&quot;settings&quot;, &quot;Settings&quot;, Icons.Default.Settings)&#10;}&#10;&#10;/**&#10; * Main app composable with navigation setup.&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun SmartRacketApp() {&#10;    val navController = rememberNavController()&#10;&#10;    val bottomNavItems = listOf(&#10;        Screen.Home,&#10;        Screen.Training,&#10;        Screen.Analytics,&#10;        Screen.Highlights,&#10;        Screen.Settings&#10;    )&#10;&#10;    Scaffold(&#10;        modifier = Modifier.fillMaxSize(),&#10;        bottomBar = {&#10;            NavigationBar {&#10;                val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;                val currentDestination = navBackStackEntry?.destination&#10;&#10;                bottomNavItems.forEach { screen -&gt;&#10;                    NavigationBarItem(&#10;                        icon = { Icon(screen.icon, contentDescription = screen.title) },&#10;                        label = { Text(screen.title) },&#10;                        selected = currentDestination?.hierarchy?.any { it.route == screen.route } == true,&#10;                        onClick = {&#10;                            navController.navigate(screen.route) {&#10;                                // Pop up to the start destination of the graph to&#10;                                // avoid building up a large stack of destinations&#10;                                popUpTo(navController.graph.findStartDestination().id) {&#10;                                    saveState = true&#10;                                }&#10;                                // Avoid multiple copies of the same destination&#10;                                launchSingleTop = true&#10;                                // Restore state when reselecting a previously selected item&#10;                                restoreState = true&#10;                            }&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    ) { innerPadding -&gt;&#10;        NavHost(&#10;            navController = navController,&#10;            startDestination = Screen.Home.route,&#10;            modifier = Modifier.padding(innerPadding)&#10;        ) {&#10;            composable(Screen.Home.route) {&#10;                HomeScreen(&#10;                    onStartTraining = {&#10;                        navController.navigate(Screen.Training.route)&#10;                    },&#10;                    onViewAnalytics = {&#10;                        navController.navigate(Screen.Analytics.route)&#10;                    },&#10;                    onViewHighlights = {&#10;                        navController.navigate(Screen.Highlights.route)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Training.route) {&#10;                TrainingScreen(&#10;                    onNavigateBack = {&#10;                        navController.navigate(Screen.Home.route) {&#10;                            popUpTo(Screen.Home.route) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Analytics.route) {&#10;                AnalyticsScreen(&#10;                    onNavigateBack = {&#10;                        navController.navigate(Screen.Home.route) {&#10;                            popUpTo(Screen.Home.route) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Highlights.route) {&#10;                HighlightsScreen(&#10;                    onNavigateBack = {&#10;                        navController.navigate(Screen.Home.route) {&#10;                            popUpTo(Screen.Home.route) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(Screen.Settings.route) {&#10;                SettingsScreen(&#10;                    onNavigateBack = {&#10;                        navController.navigate(Screen.Home.route) {&#10;                            popUpTo(Screen.Home.route) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/smartracket/com/ui/screens/HighlightsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/smartracket/com/ui/screens/HighlightsScreen.kt" />
              <option name="originalContent" value="package smartracket.com.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import smartracket.com.viewmodel.HighlightsViewModel&#10;import smartracket.com.viewmodel.HighlightItemUi&#10;&#10;/**&#10; * Highlights Gallery Screen - Saved highlight clips.&#10; *&#10; * Displays:&#10; * - Grid/list of saved highlights&#10; * - Filter by date/stroke type&#10; * - Sharing options&#10; * - Highlight details and playback&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HighlightsScreen(&#10;    viewModel: HighlightsViewModel = hiltViewModel()&#10;) {&#10;    val highlights by viewModel.highlights.collectAsState()&#10;    val selectedFilter by viewModel.selectedFilter.collectAsState()&#10;    val isLoading by viewModel.isLoading.collectAsState()&#10;    val selectedHighlight by viewModel.selectedHighlight.collectAsState()&#10;&#10;    val filterOptions = listOf(&quot;All&quot;, &quot;Auto-saved&quot;, &quot;Manual&quot;, &quot;High Score&quot;)&#10;&#10;    Column(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        // Header&#10;        TopAppBar(&#10;            title = { Text(&quot;Highlights&quot;) },&#10;            actions = {&#10;                // View toggle (grid/list)&#10;                var isGridView by remember { mutableStateOf(true) }&#10;                IconButton(onClick = { isGridView = !isGridView }) {&#10;                    Icon(&#10;                        imageVector = if (isGridView) Icons.Default.ViewList else Icons.Default.GridView,&#10;                        contentDescription = &quot;Toggle view&quot;&#10;                    )&#10;                }&#10;            }&#10;        )&#10;&#10;        // Filter chips&#10;        LazyRow(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(horizontal = 16.dp, vertical = 8.dp),&#10;            horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            items(filterOptions) { filter -&gt;&#10;                FilterChip(&#10;                    selected = selectedFilter == filter,&#10;                    onClick = { viewModel.setFilter(filter) },&#10;                    label = { Text(filter) }&#10;                )&#10;            }&#10;        }&#10;&#10;        // Content&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier.fillMaxSize(),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator()&#10;            }&#10;        } else if (highlights.isEmpty()) {&#10;            EmptyHighlightsState()&#10;        } else {&#10;            HighlightsGrid(&#10;                highlights = highlights,&#10;                onHighlightClick = { viewModel.selectHighlight(it) },&#10;                onDeleteClick = { viewModel.deleteHighlight(it) },&#10;                onShareClick = { viewModel.shareHighlight(it) }&#10;            )&#10;        }&#10;    }&#10;&#10;    // Highlight detail bottom sheet&#10;    selectedHighlight?.let { highlight -&gt;&#10;        ModalBottomSheet(&#10;            onDismissRequest = { viewModel.clearSelectedHighlight() }&#10;        ) {&#10;            HighlightDetailSheet(&#10;                highlight = highlight,&#10;                onDismiss = { viewModel.clearSelectedHighlight() },&#10;                onShare = { viewModel.shareHighlight(highlight.clipId) },&#10;                onDelete = {&#10;                    viewModel.deleteHighlight(highlight.clipId)&#10;                    viewModel.clearSelectedHighlight()&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun EmptyHighlightsState() {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(32.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = Icons.Default.Stars,&#10;            contentDescription = null,&#10;            modifier = Modifier.size(80.dp),&#10;            tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.3f)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        Text(&#10;            text = &quot;No Highlights Yet&quot;,&#10;            style = MaterialTheme.typography.titleLarge,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;&#10;        Text(&#10;            text = &quot;Exceptional strokes (score 8+) are automatically saved as highlights. You can also manually save highlights during training.&quot;,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            textAlign = TextAlign.Center,&#10;            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        OutlinedButton(onClick = { /* Navigate to training */ }) {&#10;            Icon(Icons.Default.FitnessCenter, contentDescription = null)&#10;            Spacer(modifier = Modifier.width(8.dp))&#10;            Text(&quot;Start Training&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HighlightsGrid(&#10;    highlights: List&lt;HighlightItemUi&gt;,&#10;    onHighlightClick: (Long) -&gt; Unit,&#10;    onDeleteClick: (Long) -&gt; Unit,&#10;    onShareClick: (Long) -&gt; Unit&#10;) {&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(horizontal = 16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp),&#10;        contentPadding = PaddingValues(vertical = 8.dp)&#10;    ) {&#10;        items(highlights) { highlight -&gt;&#10;            HighlightCard(&#10;                highlight = highlight,&#10;                onClick = { onHighlightClick(highlight.clipId) },&#10;                onDelete = { onDeleteClick(highlight.clipId) },&#10;                onShare = { onShareClick(highlight.clipId) }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;private fun HighlightCard(&#10;    highlight: HighlightItemUi,&#10;    onClick: () -&gt; Unit,&#10;    onDelete: () -&gt; Unit,&#10;    onShare: () -&gt; Unit&#10;) {&#10;    var showMenu by remember { mutableStateOf(false) }&#10;&#10;    Card(&#10;        onClick = onClick,&#10;        modifier = Modifier.fillMaxWidth()&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(12.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Thumbnail placeholder&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(72.dp)&#10;                    .clip(RoundedCornerShape(8.dp))&#10;                    .background(getScoreColor(highlight.score).copy(alpha = 0.2f)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.SportsTennis,&#10;                        contentDescription = null,&#10;                        tint = getScoreColor(highlight.score),&#10;                        modifier = Modifier.size(28.dp)&#10;                    )&#10;                    Text(&#10;                        text = highlight.score.toString(),&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = getScoreColor(highlight.score)&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Text(&#10;                        text = highlight.title,&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        maxLines = 1,&#10;                        overflow = TextOverflow.Ellipsis,&#10;                        modifier = Modifier.weight(1f)&#10;                    )&#10;&#10;                    if (highlight.isAutoSaved) {&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Surface(&#10;                            color = MaterialTheme.colorScheme.secondaryContainer,&#10;                            shape = RoundedCornerShape(4.dp)&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;AUTO&quot;,&#10;                                style = MaterialTheme.typography.labelSmall,&#10;                                modifier = Modifier.padding(horizontal = 6.dp, vertical = 2.dp)&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;&#10;                Text(&#10;                    text = highlight.strokeType,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = MaterialTheme.colorScheme.primary&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.CalendarToday,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(14.dp),&#10;                        tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(4.dp))&#10;                    Text(&#10;                        text = highlight.dateFormatted,&#10;                        style = MaterialTheme.typography.bodySmall,&#10;                        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    )&#10;&#10;                    highlight.heartRate?.let { hr -&gt;&#10;                        Spacer(modifier = Modifier.width(12.dp))&#10;                        Icon(&#10;                            imageVector = Icons.Default.Favorite,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(14.dp),&#10;                            tint = Color(0xFFE91E63)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;$hr BPM&quot;,&#10;                            style = MaterialTheme.typography.bodySmall,&#10;                            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Menu button&#10;            Box {&#10;                IconButton(onClick = { showMenu = true }) {&#10;                    Icon(Icons.Default.MoreVert, contentDescription = &quot;More options&quot;)&#10;                }&#10;&#10;                DropdownMenu(&#10;                    expanded = showMenu,&#10;                    onDismissRequest = { showMenu = false }&#10;                ) {&#10;                    DropdownMenuItem(&#10;                        text = { Text(&quot;Share&quot;) },&#10;                        onClick = {&#10;                            onShare()&#10;                            showMenu = false&#10;                        },&#10;                        leadingIcon = { Icon(Icons.Default.Share, contentDescription = null) }&#10;                    )&#10;                    DropdownMenuItem(&#10;                        text = { Text(&quot;Delete&quot;) },&#10;                        onClick = {&#10;                            onDelete()&#10;                            showMenu = false&#10;                        },&#10;                        leadingIcon = {&#10;                            Icon(&#10;                                Icons.Default.Delete,&#10;                                contentDescription = null,&#10;                                tint = MaterialTheme.colorScheme.error&#10;                            )&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HighlightDetailSheet(&#10;    highlight: HighlightItemUi,&#10;    onDismiss: () -&gt; Unit,&#10;    onShare: () -&gt; Unit,&#10;    onDelete: () -&gt; Unit&#10;) {&#10;    var showDeleteDialog by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(24.dp)&#10;    ) {&#10;        // Header&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Text(&#10;                text = highlight.title,&#10;                style = MaterialTheme.typography.headlineSmall,&#10;                fontWeight = FontWeight.Bold,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            if (highlight.isAutoSaved) {&#10;                Surface(&#10;                    color = MaterialTheme.colorScheme.secondaryContainer,&#10;                    shape = RoundedCornerShape(4.dp)&#10;                ) {&#10;                    Text(&#10;                        text = &quot;AUTO-SAVED&quot;,&#10;                        style = MaterialTheme.typography.labelSmall,&#10;                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp)&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Motion visualization placeholder&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(200.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surfaceVariant&#10;            )&#10;        ) {&#10;            Box(&#10;                modifier = Modifier.fillMaxSize(),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Replay,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(48.dp),&#10;                        tint = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    Text(&#10;                        text = &quot;Motion Visualization&quot;,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Stats&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceEvenly&#10;        ) {&#10;            StatItem(&#10;                value = highlight.score.toString(),&#10;                label = &quot;Score&quot;,&#10;                valueColor = getScoreColor(highlight.score)&#10;            )&#10;            StatItem(&#10;                value = String.format(&quot;%.0f%%&quot;, highlight.confidence * 100),&#10;                label = &quot;Confidence&quot;&#10;            )&#10;            StatItem(&#10;                value = highlight.heartRate?.toString() ?: &quot;-&quot;,&#10;                label = &quot;BPM&quot;&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;&#10;        // Feedback&#10;        highlight.feedback?.let { feedback -&gt;&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = MaterialTheme.colorScheme.secondaryContainer.copy(alpha = 0.5f)&#10;                )&#10;            ) {&#10;                Row(&#10;                    modifier = Modifier.padding(16.dp),&#10;                    verticalAlignment = Alignment.Top&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Lightbulb,&#10;                        contentDescription = null,&#10;                        tint = MaterialTheme.colorScheme.secondary&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = feedback,&#10;                        style = MaterialTheme.typography.bodyMedium&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Action buttons&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            OutlinedButton(&#10;                onClick = { showDeleteDialog = true },&#10;                modifier = Modifier.weight(1f),&#10;                colors = ButtonDefaults.outlinedButtonColors(&#10;                    contentColor = MaterialTheme.colorScheme.error&#10;                )&#10;            ) {&#10;                Icon(Icons.Default.Delete, contentDescription = null)&#10;                Spacer(modifier = Modifier.width(8.dp))&#10;                Text(&quot;Delete&quot;)&#10;            }&#10;&#10;            Button(&#10;                onClick = onShare,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Icon(Icons.Default.Share, contentDescription = null)&#10;                Spacer(modifier = Modifier.width(8.dp))&#10;                Text(&quot;Share&quot;)&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;    }&#10;&#10;    if (showDeleteDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { showDeleteDialog = false },&#10;            title = { Text(&quot;Delete Highlight?&quot;) },&#10;            text = { Text(&quot;This will permanently delete this highlight.&quot;) },&#10;            confirmButton = {&#10;                TextButton(onClick = {&#10;                    onDelete()&#10;                    showDeleteDialog = false&#10;                }) {&#10;                    Text(&quot;Delete&quot;, color = MaterialTheme.colorScheme.error)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { showDeleteDialog = false }) {&#10;                    Text(&quot;Cancel&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun StatItem(&#10;    value: String,&#10;    label: String,&#10;    valueColor: Color = MaterialTheme.colorScheme.onSurface&#10;) {&#10;    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.headlineSmall,&#10;            fontWeight = FontWeight.Bold,&#10;            color = valueColor&#10;        )&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.labelMedium,&#10;            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;        )&#10;    }&#10;}&#10;&#10;private fun getScoreColor(score: Int): Color {&#10;    return when {&#10;        score &gt;= 8 -&gt; Color(0xFF4CAF50)&#10;        score &gt;= 6 -&gt; Color(0xFF8BC34A)&#10;        score &gt;= 4 -&gt; Color(0xFFFF9800)&#10;        else -&gt; Color(0xFFF44336)&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package smartracket.com.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.text.style.TextOverflow&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import smartracket.com.viewmodel.HighlightsViewModel&#10;import smartracket.com.viewmodel.HighlightItemUi&#10;&#10;/**&#10; * Highlights Gallery Screen - Saved highlight clips.&#10; *&#10; * Displays:&#10; * - Grid/list of saved highlights&#10; * - Filter by date/stroke type&#10; * - Sharing options&#10; * - Highlight details and playback&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HighlightsScreen(&#10;    onNavigateBack: () -&gt; Unit = {},&#10;    viewModel: HighlightsViewModel = hiltViewModel()&#10;) {&#10;    val highlights by viewModel.highlights.collectAsState()&#10;    val selectedFilter by viewModel.selectedFilter.collectAsState()&#10;    val isLoading by viewModel.isLoading.collectAsState()&#10;    val selectedHighlight by viewModel.selectedHighlight.collectAsState()&#10;&#10;    val filterOptions = listOf(&quot;All&quot;, &quot;Auto-saved&quot;, &quot;Manual&quot;, &quot;High Score&quot;)&#10;&#10;    Column(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        // Header&#10;        TopAppBar(&#10;            title = { Text(&quot;Highlights&quot;) },&#10;            actions = {&#10;                // View toggle (grid/list)&#10;                var isGridView by remember { mutableStateOf(true) }&#10;                IconButton(onClick = { isGridView = !isGridView }) {&#10;                    Icon(&#10;                        imageVector = if (isGridView) Icons.Default.ViewList else Icons.Default.GridView,&#10;                        contentDescription = &quot;Toggle view&quot;&#10;                    )&#10;                }&#10;            }&#10;        )&#10;&#10;        // Filter chips&#10;        LazyRow(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(horizontal = 16.dp, vertical = 8.dp),&#10;            horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            items(filterOptions) { filter -&gt;&#10;                FilterChip(&#10;                    selected = selectedFilter == filter,&#10;                    onClick = { viewModel.setFilter(filter) },&#10;                    label = { Text(filter) }&#10;                )&#10;            }&#10;        }&#10;&#10;        // Content&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier.fillMaxSize(),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator()&#10;            }&#10;        } else if (highlights.isEmpty()) {&#10;            EmptyHighlightsState()&#10;        } else {&#10;            HighlightsGrid(&#10;                highlights = highlights,&#10;                onHighlightClick = { viewModel.selectHighlight(it) },&#10;                onDeleteClick = { viewModel.deleteHighlight(it) },&#10;                onShareClick = { viewModel.shareHighlight(it) }&#10;            )&#10;        }&#10;    }&#10;&#10;    // Highlight detail bottom sheet&#10;    selectedHighlight?.let { highlight -&gt;&#10;        ModalBottomSheet(&#10;            onDismissRequest = { viewModel.clearSelectedHighlight() }&#10;        ) {&#10;            HighlightDetailSheet(&#10;                highlight = highlight,&#10;                onDismiss = { viewModel.clearSelectedHighlight() },&#10;                onShare = { viewModel.shareHighlight(highlight.clipId) },&#10;                onDelete = {&#10;                    viewModel.deleteHighlight(highlight.clipId)&#10;                    viewModel.clearSelectedHighlight()&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun EmptyHighlightsState() {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(32.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Icon(&#10;            imageVector = Icons.Default.Stars,&#10;            contentDescription = null,&#10;            modifier = Modifier.size(80.dp),&#10;            tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.3f)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        Text(&#10;            text = &quot;No Highlights Yet&quot;,&#10;            style = MaterialTheme.typography.titleLarge,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(8.dp))&#10;&#10;        Text(&#10;            text = &quot;Exceptional strokes (score 8+) are automatically saved as highlights. You can also manually save highlights during training.&quot;,&#10;            style = MaterialTheme.typography.bodyMedium,&#10;            textAlign = TextAlign.Center,&#10;            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        OutlinedButton(onClick = { /* Navigate to training */ }) {&#10;            Icon(Icons.Default.FitnessCenter, contentDescription = null)&#10;            Spacer(modifier = Modifier.width(8.dp))&#10;            Text(&quot;Start Training&quot;)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HighlightsGrid(&#10;    highlights: List&lt;HighlightItemUi&gt;,&#10;    onHighlightClick: (Long) -&gt; Unit,&#10;    onDeleteClick: (Long) -&gt; Unit,&#10;    onShareClick: (Long) -&gt; Unit&#10;) {&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(horizontal = 16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp),&#10;        contentPadding = PaddingValues(vertical = 8.dp)&#10;    ) {&#10;        items(highlights) { highlight -&gt;&#10;            HighlightCard(&#10;                highlight = highlight,&#10;                onClick = { onHighlightClick(highlight.clipId) },&#10;                onDelete = { onDeleteClick(highlight.clipId) },&#10;                onShare = { onShareClick(highlight.clipId) }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;private fun HighlightCard(&#10;    highlight: HighlightItemUi,&#10;    onClick: () -&gt; Unit,&#10;    onDelete: () -&gt; Unit,&#10;    onShare: () -&gt; Unit&#10;) {&#10;    var showMenu by remember { mutableStateOf(false) }&#10;&#10;    Card(&#10;        onClick = onClick,&#10;        modifier = Modifier.fillMaxWidth()&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(12.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Thumbnail placeholder&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(72.dp)&#10;                    .clip(RoundedCornerShape(8.dp))&#10;                    .background(getScoreColor(highlight.score).copy(alpha = 0.2f)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.SportsTennis,&#10;                        contentDescription = null,&#10;                        tint = getScoreColor(highlight.score),&#10;                        modifier = Modifier.size(28.dp)&#10;                    )&#10;                    Text(&#10;                        text = highlight.score.toString(),&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = getScoreColor(highlight.score)&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Text(&#10;                        text = highlight.title,&#10;                        style = MaterialTheme.typography.titleMedium,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        maxLines = 1,&#10;                        overflow = TextOverflow.Ellipsis,&#10;                        modifier = Modifier.weight(1f)&#10;                    )&#10;&#10;                    if (highlight.isAutoSaved) {&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Surface(&#10;                            color = MaterialTheme.colorScheme.secondaryContainer,&#10;                            shape = RoundedCornerShape(4.dp)&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;AUTO&quot;,&#10;                                style = MaterialTheme.typography.labelSmall,&#10;                                modifier = Modifier.padding(horizontal = 6.dp, vertical = 2.dp)&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;&#10;                Text(&#10;                    text = highlight.strokeType,&#10;                    style = MaterialTheme.typography.bodyMedium,&#10;                    color = MaterialTheme.colorScheme.primary&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.CalendarToday,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(14.dp),&#10;                        tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    )&#10;                    Spacer(modifier = Modifier.width(4.dp))&#10;                    Text(&#10;                        text = highlight.dateFormatted,&#10;                        style = MaterialTheme.typography.bodySmall,&#10;                        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    )&#10;&#10;                    highlight.heartRate?.let { hr -&gt;&#10;                        Spacer(modifier = Modifier.width(12.dp))&#10;                        Icon(&#10;                            imageVector = Icons.Default.Favorite,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(14.dp),&#10;                            tint = Color(0xFFE91E63)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(4.dp))&#10;                        Text(&#10;                            text = &quot;$hr BPM&quot;,&#10;                            style = MaterialTheme.typography.bodySmall,&#10;                            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Menu button&#10;            Box {&#10;                IconButton(onClick = { showMenu = true }) {&#10;                    Icon(Icons.Default.MoreVert, contentDescription = &quot;More options&quot;)&#10;                }&#10;&#10;                DropdownMenu(&#10;                    expanded = showMenu,&#10;                    onDismissRequest = { showMenu = false }&#10;                ) {&#10;                    DropdownMenuItem(&#10;                        text = { Text(&quot;Share&quot;) },&#10;                        onClick = {&#10;                            onShare()&#10;                            showMenu = false&#10;                        },&#10;                        leadingIcon = { Icon(Icons.Default.Share, contentDescription = null) }&#10;                    )&#10;                    DropdownMenuItem(&#10;                        text = { Text(&quot;Delete&quot;) },&#10;                        onClick = {&#10;                            onDelete()&#10;                            showMenu = false&#10;                        },&#10;                        leadingIcon = {&#10;                            Icon(&#10;                                Icons.Default.Delete,&#10;                                contentDescription = null,&#10;                                tint = MaterialTheme.colorScheme.error&#10;                            )&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun HighlightDetailSheet(&#10;    highlight: HighlightItemUi,&#10;    onDismiss: () -&gt; Unit,&#10;    onShare: () -&gt; Unit,&#10;    onDelete: () -&gt; Unit&#10;) {&#10;    var showDeleteDialog by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(24.dp)&#10;    ) {&#10;        // Header&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Text(&#10;                text = highlight.title,&#10;                style = MaterialTheme.typography.headlineSmall,&#10;                fontWeight = FontWeight.Bold,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            if (highlight.isAutoSaved) {&#10;                Surface(&#10;                    color = MaterialTheme.colorScheme.secondaryContainer,&#10;                    shape = RoundedCornerShape(4.dp)&#10;                ) {&#10;                    Text(&#10;                        text = &quot;AUTO-SAVED&quot;,&#10;                        style = MaterialTheme.typography.labelSmall,&#10;                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp)&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Motion visualization placeholder&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(200.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surfaceVariant&#10;            )&#10;        ) {&#10;            Box(&#10;                modifier = Modifier.fillMaxSize(),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Replay,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(48.dp),&#10;                        tint = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    Text(&#10;                        text = &quot;Motion Visualization&quot;,&#10;                        style = MaterialTheme.typography.bodyMedium,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Stats&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.SpaceEvenly&#10;        ) {&#10;            StatItem(&#10;                value = highlight.score.toString(),&#10;                label = &quot;Score&quot;,&#10;                valueColor = getScoreColor(highlight.score)&#10;            )&#10;            StatItem(&#10;                value = String.format(&quot;%.0f%%&quot;, highlight.confidence * 100),&#10;                label = &quot;Confidence&quot;&#10;            )&#10;            StatItem(&#10;                value = highlight.heartRate?.toString() ?: &quot;-&quot;,&#10;                label = &quot;BPM&quot;&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;&#10;        // Feedback&#10;        highlight.feedback?.let { feedback -&gt;&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = MaterialTheme.colorScheme.secondaryContainer.copy(alpha = 0.5f)&#10;                )&#10;            ) {&#10;                Row(&#10;                    modifier = Modifier.padding(16.dp),&#10;                    verticalAlignment = Alignment.Top&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Lightbulb,&#10;                        contentDescription = null,&#10;                        tint = MaterialTheme.colorScheme.secondary&#10;                    )&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;                    Text(&#10;                        text = feedback,&#10;                        style = MaterialTheme.typography.bodyMedium&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        // Action buttons&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            OutlinedButton(&#10;                onClick = { showDeleteDialog = true },&#10;                modifier = Modifier.weight(1f),&#10;                colors = ButtonDefaults.outlinedButtonColors(&#10;                    contentColor = MaterialTheme.colorScheme.error&#10;                )&#10;            ) {&#10;                Icon(Icons.Default.Delete, contentDescription = null)&#10;                Spacer(modifier = Modifier.width(8.dp))&#10;                Text(&quot;Delete&quot;)&#10;            }&#10;&#10;            Button(&#10;                onClick = onShare,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Icon(Icons.Default.Share, contentDescription = null)&#10;                Spacer(modifier = Modifier.width(8.dp))&#10;                Text(&quot;Share&quot;)&#10;            }&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;    }&#10;&#10;    if (showDeleteDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { showDeleteDialog = false },&#10;            title = { Text(&quot;Delete Highlight?&quot;) },&#10;            text = { Text(&quot;This will permanently delete this highlight.&quot;) },&#10;            confirmButton = {&#10;                TextButton(onClick = {&#10;                    onDelete()&#10;                    showDeleteDialog = false&#10;                }) {&#10;                    Text(&quot;Delete&quot;, color = MaterialTheme.colorScheme.error)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { showDeleteDialog = false }) {&#10;                    Text(&quot;Cancel&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun StatItem(&#10;    value: String,&#10;    label: String,&#10;    valueColor: Color = MaterialTheme.colorScheme.onSurface&#10;) {&#10;    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;        Text(&#10;            text = value,&#10;            style = MaterialTheme.typography.headlineSmall,&#10;            fontWeight = FontWeight.Bold,&#10;            color = valueColor&#10;        )&#10;        Text(&#10;            text = label,&#10;            style = MaterialTheme.typography.labelMedium,&#10;            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;        )&#10;    }&#10;}&#10;&#10;private fun getScoreColor(score: Int): Color {&#10;    return when {&#10;        score &gt;= 8 -&gt; Color(0xFF4CAF50)&#10;        score &gt;= 6 -&gt; Color(0xFF8BC34A)&#10;        score &gt;= 4 -&gt; Color(0xFFFF9800)&#10;        else -&gt; Color(0xFFF44336)&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/smartracket/com/ui/screens/SettingsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/smartracket/com/ui/screens/SettingsScreen.kt" />
              <option name="originalContent" value="package smartracket.com.ui.screens&#10;&#10;import android.Manifest&#10;import android.os.Build&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import com.google.accompanist.permissions.ExperimentalPermissionsApi&#10;import com.google.accompanist.permissions.rememberMultiplePermissionsState&#10;import smartracket.com.model.BluetoothConnectionState&#10;import smartracket.com.viewmodel.SettingsViewModel&#10;&#10;/**&#10; * Settings Screen - App preferences and device management.&#10; *&#10; * Contains:&#10; * - Bluetooth device pairing&#10; * - User profile settings&#10; * - Health sync toggle&#10; * - Auto-save highlight threshold&#10; * - App preferences&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class, ExperimentalPermissionsApi::class)&#10;@Composable&#10;fun SettingsScreen(&#10;    viewModel: SettingsViewModel = hiltViewModel()&#10;) {&#10;    val connectionState by viewModel.connectionState.collectAsState()&#10;    val pairedDevices by viewModel.pairedDevices.collectAsState()&#10;    val isHealthConnectAvailable by viewModel.isHealthConnectAvailable.collectAsState()&#10;    val hasHealthPermissions by viewModel.hasHealthPermissions.collectAsState()&#10;    val autoSaveThreshold by viewModel.autoSaveThreshold.collectAsState()&#10;    val keepScreenOn by viewModel.keepScreenOn.collectAsState()&#10;    val vibrationEnabled by viewModel.vibrationEnabled.collectAsState()&#10;&#10;    // Bluetooth permissions&#10;    val bluetoothPermissions = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;        listOf(&#10;            Manifest.permission.BLUETOOTH_SCAN,&#10;            Manifest.permission.BLUETOOTH_CONNECT&#10;        )&#10;    } else {&#10;        listOf(&#10;            Manifest.permission.BLUETOOTH,&#10;            Manifest.permission.BLUETOOTH_ADMIN,&#10;            Manifest.permission.ACCESS_FINE_LOCATION&#10;        )&#10;    }&#10;&#10;    val permissionState = rememberMultiplePermissionsState(bluetoothPermissions)&#10;&#10;    Column(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        TopAppBar(&#10;            title = { Text(&quot;Settings&quot;) }&#10;        )&#10;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .verticalScroll(rememberScrollState())&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(16.dp)&#10;        ) {&#10;            // Bluetooth Section&#10;            SettingsSection(title = &quot;Bluetooth&quot;) {&#10;                // Connection status&#10;                val currentState = connectionState&#10;                SettingsItem(&#10;                    icon = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt; Icons.Default.BluetoothConnected&#10;                        is BluetoothConnectionState.Connecting,&#10;                        BluetoothConnectionState.Scanning -&gt; Icons.Default.BluetoothSearching&#10;                        else -&gt; Icons.Default.BluetoothDisabled&#10;                    },&#10;                    title = &quot;Paddle Connection&quot;,&#10;                    subtitle = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt;&#10;                            &quot;Connected to ${currentState.device.deviceName}&quot;&#10;                        is BluetoothConnectionState.Connecting -&gt; &quot;Connecting to ${currentState.deviceName}...&quot;&#10;                        BluetoothConnectionState.Scanning -&gt; &quot;Scanning...&quot;&#10;                        is BluetoothConnectionState.Error -&gt; currentState.message&#10;                        else -&gt; &quot;Not connected&quot;&#10;                    },&#10;                    iconTint = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt; Color(0xFF4CAF50)&#10;                        is BluetoothConnectionState.Connecting,&#10;                        BluetoothConnectionState.Scanning -&gt; Color(0xFF2196F3)&#10;                        is BluetoothConnectionState.Error -&gt; Color(0xFFF44336)&#10;                        else -&gt; MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    }&#10;                ) {&#10;                    if (currentState is BluetoothConnectionState.Connected) {&#10;                        TextButton(onClick = { viewModel.disconnectDevice() }) {&#10;                            Text(&quot;Disconnect&quot;)&#10;                        }&#10;                    } else if (currentState !is BluetoothConnectionState.Connecting &amp;&amp;&#10;                               currentState !is BluetoothConnectionState.Scanning) {&#10;                        if (permissionState.allPermissionsGranted) {&#10;                            TextButton(onClick = { viewModel.startScan() }) {&#10;                                Text(&quot;Scan&quot;)&#10;                            }&#10;                        } else {&#10;                            TextButton(onClick = { permissionState.launchMultiplePermissionRequest() }) {&#10;                                Text(&quot;Grant Permission&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                // Paired devices&#10;                if (pairedDevices.isNotEmpty()) {&#10;                    pairedDevices.forEach { device -&gt;&#10;                        SettingsItem(&#10;                            icon = Icons.Default.SportsTennis,&#10;                            title = device.deviceName,&#10;                            subtitle = &quot;Last connected: ${device.lastConnectedFormatted}&quot;&#10;                        ) {&#10;                            TextButton(onClick = { viewModel.connectToDevice(device.address) }) {&#10;                                Text(&quot;Connect&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Health Connect Section&#10;            SettingsSection(title = &quot;Health &amp; Fitness&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.Favorite,&#10;                    title = &quot;Health Connect&quot;,&#10;                    subtitle = when {&#10;                        !isHealthConnectAvailable -&gt; &quot;Not available on this device&quot;&#10;                        hasHealthPermissions -&gt; &quot;Connected - syncing heart rate data&quot;&#10;                        else -&gt; &quot;Tap to connect&quot;&#10;                    },&#10;                    iconTint = if (hasHealthPermissions) Color(0xFFE91E63)&#10;                              else MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                ) {&#10;                    if (isHealthConnectAvailable &amp;&amp; !hasHealthPermissions) {&#10;                        TextButton(onClick = { viewModel.requestHealthPermissions() }) {&#10;                            Text(&quot;Connect&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Training Settings&#10;            SettingsSection(title = &quot;Training&quot;) {&#10;                // Auto-save threshold&#10;                SettingsSliderItem(&#10;                    icon = Icons.Default.Stars,&#10;                    title = &quot;Auto-save Highlight Threshold&quot;,&#10;                    subtitle = &quot;Score $autoSaveThreshold and above&quot;,&#10;                    value = autoSaveThreshold.toFloat(),&#10;                    valueRange = 5f..10f,&#10;                    steps = 4,&#10;                    onValueChange = { viewModel.setAutoSaveThreshold(it.toInt()) }&#10;                )&#10;&#10;                // Keep screen on&#10;                SettingsSwitchItem(&#10;                    icon = Icons.Default.ScreenLockPortrait,&#10;                    title = &quot;Keep Screen On&quot;,&#10;                    subtitle = &quot;Prevent screen from turning off during training&quot;,&#10;                    checked = keepScreenOn,&#10;                    onCheckedChange = { viewModel.setKeepScreenOn(it) }&#10;                )&#10;&#10;                // Vibration&#10;                SettingsSwitchItem(&#10;                    icon = Icons.Default.Vibration,&#10;                    title = &quot;Vibration Feedback&quot;,&#10;                    subtitle = &quot;Vibrate on stroke detection&quot;,&#10;                    checked = vibrationEnabled,&#10;                    onCheckedChange = { viewModel.setVibrationEnabled(it) }&#10;                )&#10;            }&#10;&#10;            // App Info&#10;            SettingsSection(title = &quot;About&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.Info,&#10;                    title = &quot;SmartRacket Coach&quot;,&#10;                    subtitle = &quot;Version 1.0.0&quot;&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Policy,&#10;                    title = &quot;Privacy Policy&quot;,&#10;                    subtitle = &quot;View our privacy policy&quot;,&#10;                    onClick = { viewModel.openPrivacyPolicy() }&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Description,&#10;                    title = &quot;Terms of Service&quot;,&#10;                    subtitle = &quot;View terms and conditions&quot;,&#10;                    onClick = { viewModel.openTerms() }&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Feedback,&#10;                    title = &quot;Send Feedback&quot;,&#10;                    subtitle = &quot;Help us improve the app&quot;,&#10;                    onClick = { viewModel.sendFeedback() }&#10;                )&#10;            }&#10;&#10;            // Data Management&#10;            SettingsSection(title = &quot;Data&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.DeleteForever,&#10;                    title = &quot;Clear All Data&quot;,&#10;                    subtitle = &quot;Delete all training sessions and highlights&quot;,&#10;                    iconTint = MaterialTheme.colorScheme.error,&#10;                    onClick = { viewModel.showClearDataDialog() }&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(32.dp))&#10;        }&#10;    }&#10;&#10;    // Clear data confirmation dialog&#10;    val showClearDataDialog by viewModel.showClearDataDialog.collectAsState()&#10;    if (showClearDataDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { viewModel.dismissClearDataDialog() },&#10;            icon = { Icon(Icons.Default.Warning, contentDescription = null) },&#10;            title = { Text(&quot;Clear All Data?&quot;) },&#10;            text = {&#10;                Text(&quot;This will permanently delete all training sessions, strokes, and highlights. This action cannot be undone.&quot;)&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = { viewModel.clearAllData() }&#10;                ) {&#10;                    Text(&quot;Clear All&quot;, color = MaterialTheme.colorScheme.error)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { viewModel.dismissClearDataDialog() }) {&#10;                    Text(&quot;Cancel&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSection(&#10;    title: String,&#10;    content: @Composable ColumnScope.() -&gt; Unit&#10;) {&#10;    Column {&#10;        Text(&#10;            text = title,&#10;            style = MaterialTheme.typography.titleSmall,&#10;            color = MaterialTheme.colorScheme.primary,&#10;            fontWeight = FontWeight.SemiBold,&#10;            modifier = Modifier.padding(bottom = 8.dp)&#10;        )&#10;&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(8.dp)&#10;            ) {&#10;                content()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    iconTint: Color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),&#10;    onClick: (() -&gt; Unit)? = null,&#10;    trailing: @Composable (() -&gt; Unit)? = null&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .then(&#10;                if (onClick != null) Modifier.clickable { onClick() }&#10;                else Modifier&#10;            )&#10;            .padding(12.dp),&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(24.dp)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.width(16.dp))&#10;&#10;        Column(modifier = Modifier.weight(1f)) {&#10;            Text(&#10;                text = title,&#10;                style = MaterialTheme.typography.bodyLarge,&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Text(&#10;                text = subtitle,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;            )&#10;        }&#10;&#10;        trailing?.invoke()&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSwitchItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    checked: Boolean,&#10;    onCheckedChange: (Boolean) -&gt; Unit&#10;) {&#10;    SettingsItem(&#10;        icon = icon,&#10;        title = title,&#10;        subtitle = subtitle&#10;    ) {&#10;        Switch(&#10;            checked = checked,&#10;            onCheckedChange = onCheckedChange&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSliderItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    value: Float,&#10;    valueRange: ClosedFloatingPointRange&lt;Float&gt;,&#10;    steps: Int,&#10;    onValueChange: (Float) -&gt; Unit&#10;) {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(12.dp)&#10;    ) {&#10;        Row(&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Icon(&#10;                imageVector = icon,&#10;                contentDescription = null,&#10;                tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),&#10;                modifier = Modifier.size(24.dp)&#10;            )&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = title,&#10;                    style = MaterialTheme.typography.bodyLarge,&#10;                    fontWeight = FontWeight.Medium&#10;                )&#10;                Text(&#10;                    text = subtitle,&#10;                    style = MaterialTheme.typography.bodySmall,&#10;                    color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                )&#10;            }&#10;        }&#10;&#10;        Slider(&#10;            value = value,&#10;            onValueChange = onValueChange,&#10;            valueRange = valueRange,&#10;            steps = steps,&#10;            modifier = Modifier.padding(start = 40.dp)&#10;        )&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package smartracket.com.ui.screens&#10;&#10;import android.Manifest&#10;import android.os.Build&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.hilt.navigation.compose.hiltViewModel&#10;import com.google.accompanist.permissions.ExperimentalPermissionsApi&#10;import com.google.accompanist.permissions.rememberMultiplePermissionsState&#10;import smartracket.com.model.BluetoothConnectionState&#10;import smartracket.com.viewmodel.SettingsViewModel&#10;&#10;/**&#10; * Settings Screen - App preferences and device management.&#10; *&#10; * Contains:&#10; * - Bluetooth device pairing&#10; * - User profile settings&#10; * - Health sync toggle&#10; * - Auto-save highlight threshold&#10; * - App preferences&#10; * - Language toggle (English/Chinese)&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class, ExperimentalPermissionsApi::class)&#10;@Composable&#10;fun SettingsScreen(&#10;    onNavigateBack: () -&gt; Unit = {},&#10;    viewModel: SettingsViewModel = hiltViewModel()&#10;) {&#10;    val connectionState by viewModel.connectionState.collectAsState()&#10;    val pairedDevices by viewModel.pairedDevices.collectAsState()&#10;    val isHealthConnectAvailable by viewModel.isHealthConnectAvailable.collectAsState()&#10;    val hasHealthPermissions by viewModel.hasHealthPermissions.collectAsState()&#10;    val autoSaveThreshold by viewModel.autoSaveThreshold.collectAsState()&#10;    val keepScreenOn by viewModel.keepScreenOn.collectAsState()&#10;    val vibrationEnabled by viewModel.vibrationEnabled.collectAsState()&#10;    val isChineseLanguage by viewModel.isChineseLanguage.collectAsState()&#10;&#10;    // Bluetooth permissions&#10;    val bluetoothPermissions = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {&#10;        listOf(&#10;            Manifest.permission.BLUETOOTH_SCAN,&#10;            Manifest.permission.BLUETOOTH_CONNECT&#10;        )&#10;    } else {&#10;        listOf(&#10;            Manifest.permission.BLUETOOTH,&#10;            Manifest.permission.BLUETOOTH_ADMIN,&#10;            Manifest.permission.ACCESS_FINE_LOCATION&#10;        )&#10;    }&#10;&#10;    val permissionState = rememberMultiplePermissionsState(bluetoothPermissions)&#10;&#10;    Column(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        TopAppBar(&#10;            title = { Text(if (isChineseLanguage) &quot;&quot; else &quot;Settings&quot;) }&#10;        )&#10;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .verticalScroll(rememberScrollState())&#10;                .padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(16.dp)&#10;        ) {&#10;            // Bluetooth Section&#10;            SettingsSection(title = &quot;Bluetooth&quot;) {&#10;                // Connection status&#10;                val currentState = connectionState&#10;                SettingsItem(&#10;                    icon = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt; Icons.Default.BluetoothConnected&#10;                        is BluetoothConnectionState.Connecting,&#10;                        BluetoothConnectionState.Scanning -&gt; Icons.Default.BluetoothSearching&#10;                        else -&gt; Icons.Default.BluetoothDisabled&#10;                    },&#10;                    title = &quot;Paddle Connection&quot;,&#10;                    subtitle = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt;&#10;                            &quot;Connected to ${currentState.device.deviceName}&quot;&#10;                        is BluetoothConnectionState.Connecting -&gt; &quot;Connecting to ${currentState.deviceName}...&quot;&#10;                        BluetoothConnectionState.Scanning -&gt; &quot;Scanning...&quot;&#10;                        is BluetoothConnectionState.Error -&gt; currentState.message&#10;                        else -&gt; &quot;Not connected&quot;&#10;                    },&#10;                    iconTint = when (currentState) {&#10;                        is BluetoothConnectionState.Connected -&gt; Color(0xFF4CAF50)&#10;                        is BluetoothConnectionState.Connecting,&#10;                        BluetoothConnectionState.Scanning -&gt; Color(0xFF2196F3)&#10;                        is BluetoothConnectionState.Error -&gt; Color(0xFFF44336)&#10;                        else -&gt; MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                    }&#10;                ) {&#10;                    if (currentState is BluetoothConnectionState.Connected) {&#10;                        TextButton(onClick = { viewModel.disconnectDevice() }) {&#10;                            Text(&quot;Disconnect&quot;)&#10;                        }&#10;                    } else if (currentState !is BluetoothConnectionState.Connecting &amp;&amp;&#10;                               currentState !is BluetoothConnectionState.Scanning) {&#10;                        if (permissionState.allPermissionsGranted) {&#10;                            TextButton(onClick = { viewModel.startScan() }) {&#10;                                Text(&quot;Scan&quot;)&#10;                            }&#10;                        } else {&#10;                            TextButton(onClick = { permissionState.launchMultiplePermissionRequest() }) {&#10;                                Text(&quot;Grant Permission&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                // Paired devices&#10;                if (pairedDevices.isNotEmpty()) {&#10;                    pairedDevices.forEach { device -&gt;&#10;                        SettingsItem(&#10;                            icon = Icons.Default.SportsTennis,&#10;                            title = device.deviceName,&#10;                            subtitle = &quot;Last connected: ${device.lastConnectedFormatted}&quot;&#10;                        ) {&#10;                            TextButton(onClick = { viewModel.connectToDevice(device.address) }) {&#10;                                Text(&quot;Connect&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Health Connect Section&#10;            SettingsSection(title = &quot;Health &amp; Fitness&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.Favorite,&#10;                    title = &quot;Health Connect&quot;,&#10;                    subtitle = when {&#10;                        !isHealthConnectAvailable -&gt; &quot;Not available on this device&quot;&#10;                        hasHealthPermissions -&gt; &quot;Connected - syncing heart rate data&quot;&#10;                        else -&gt; &quot;Tap to connect&quot;&#10;                    },&#10;                    iconTint = if (hasHealthPermissions) Color(0xFFE91E63)&#10;                              else MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                ) {&#10;                    if (isHealthConnectAvailable &amp;&amp; !hasHealthPermissions) {&#10;                        TextButton(onClick = { viewModel.requestHealthPermissions() }) {&#10;                            Text(&quot;Connect&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            // Training Settings&#10;            SettingsSection(title = &quot;Training&quot;) {&#10;                // Auto-save threshold&#10;                SettingsSliderItem(&#10;                    icon = Icons.Default.Stars,&#10;                    title = &quot;Auto-save Highlight Threshold&quot;,&#10;                    subtitle = &quot;Score $autoSaveThreshold and above&quot;,&#10;                    value = autoSaveThreshold.toFloat(),&#10;                    valueRange = 5f..10f,&#10;                    steps = 4,&#10;                    onValueChange = { viewModel.setAutoSaveThreshold(it.toInt()) }&#10;                )&#10;&#10;                // Keep screen on&#10;                SettingsSwitchItem(&#10;                    icon = Icons.Default.ScreenLockPortrait,&#10;                    title = &quot;Keep Screen On&quot;,&#10;                    subtitle = &quot;Prevent screen from turning off during training&quot;,&#10;                    checked = keepScreenOn,&#10;                    onCheckedChange = { viewModel.setKeepScreenOn(it) }&#10;                )&#10;&#10;                // Vibration&#10;                SettingsSwitchItem(&#10;                    icon = Icons.Default.Vibration,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Vibration Feedback&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot;&quot; else &quot;Vibrate on stroke detection&quot;,&#10;                    checked = vibrationEnabled,&#10;                    onCheckedChange = { viewModel.setVibrationEnabled(it) }&#10;                )&#10;            }&#10;&#10;            // Language Settings&#10;            SettingsSection(title = if (isChineseLanguage) &quot;&quot; else &quot;Language&quot;) {&#10;                SettingsSwitchItem(&#10;                    icon = Icons.Default.Language,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Chinese Mode&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot; / Switch to English&quot; else &quot; / Switch to Chinese&quot;,&#10;                    checked = isChineseLanguage,&#10;                    onCheckedChange = { viewModel.setChineseLanguage(it) }&#10;                )&#10;            }&#10;&#10;            // App Info&#10;            SettingsSection(title = if (isChineseLanguage) &quot;&quot; else &quot;About&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.Info,&#10;                    title = &quot;SmartRacket Coach&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot; 1.0.0&quot; else &quot;Version 1.0.0&quot;&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Policy,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Privacy Policy&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot;&quot; else &quot;View our privacy policy&quot;,&#10;                    onClick = { viewModel.openPrivacyPolicy() }&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Description,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Terms of Service&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot;&quot; else &quot;View terms and conditions&quot;,&#10;                    onClick = { viewModel.openTerms() }&#10;                )&#10;&#10;                SettingsItem(&#10;                    icon = Icons.Default.Feedback,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Send Feedback&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot;&quot; else &quot;Help us improve the app&quot;,&#10;                    onClick = { viewModel.sendFeedback() }&#10;                )&#10;            }&#10;&#10;            // Data Management&#10;            SettingsSection(title = if (isChineseLanguage) &quot;&quot; else &quot;Data&quot;) {&#10;                SettingsItem(&#10;                    icon = Icons.Default.DeleteForever,&#10;                    title = if (isChineseLanguage) &quot;&quot; else &quot;Clear All Data&quot;,&#10;                    subtitle = if (isChineseLanguage) &quot;&quot; else &quot;Delete all training sessions and highlights&quot;,&#10;                    iconTint = MaterialTheme.colorScheme.error,&#10;                    onClick = { viewModel.showClearDataDialog() }&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(32.dp))&#10;        }&#10;    }&#10;&#10;    // Clear data confirmation dialog&#10;    val showClearDataDialog by viewModel.showClearDataDialog.collectAsState()&#10;    if (showClearDataDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { viewModel.dismissClearDataDialog() },&#10;            icon = { Icon(Icons.Default.Warning, contentDescription = null) },&#10;            title = { Text(&quot;Clear All Data?&quot;) },&#10;            text = {&#10;                Text(&quot;This will permanently delete all training sessions, strokes, and highlights. This action cannot be undone.&quot;)&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = { viewModel.clearAllData() }&#10;                ) {&#10;                    Text(&quot;Clear All&quot;, color = MaterialTheme.colorScheme.error)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { viewModel.dismissClearDataDialog() }) {&#10;                    Text(&quot;Cancel&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSection(&#10;    title: String,&#10;    content: @Composable ColumnScope.() -&gt; Unit&#10;) {&#10;    Column {&#10;        Text(&#10;            text = title,&#10;            style = MaterialTheme.typography.titleSmall,&#10;            color = MaterialTheme.colorScheme.primary,&#10;            fontWeight = FontWeight.SemiBold,&#10;            modifier = Modifier.padding(bottom = 8.dp)&#10;        )&#10;&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(8.dp)&#10;            ) {&#10;                content()&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    iconTint: Color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),&#10;    onClick: (() -&gt; Unit)? = null,&#10;    trailing: @Composable (() -&gt; Unit)? = null&#10;) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .then(&#10;                if (onClick != null) Modifier.clickable { onClick() }&#10;                else Modifier&#10;            )&#10;            .padding(12.dp),&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        Icon(&#10;            imageVector = icon,&#10;            contentDescription = null,&#10;            tint = iconTint,&#10;            modifier = Modifier.size(24.dp)&#10;        )&#10;&#10;        Spacer(modifier = Modifier.width(16.dp))&#10;&#10;        Column(modifier = Modifier.weight(1f)) {&#10;            Text(&#10;                text = title,&#10;                style = MaterialTheme.typography.bodyLarge,&#10;                fontWeight = FontWeight.Medium&#10;            )&#10;            Text(&#10;                text = subtitle,&#10;                style = MaterialTheme.typography.bodySmall,&#10;                color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;            )&#10;        }&#10;&#10;        trailing?.invoke()&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSwitchItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    checked: Boolean,&#10;    onCheckedChange: (Boolean) -&gt; Unit&#10;) {&#10;    SettingsItem(&#10;        icon = icon,&#10;        title = title,&#10;        subtitle = subtitle&#10;    ) {&#10;        Switch(&#10;            checked = checked,&#10;            onCheckedChange = onCheckedChange&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SettingsSliderItem(&#10;    icon: ImageVector,&#10;    title: String,&#10;    subtitle: String,&#10;    value: Float,&#10;    valueRange: ClosedFloatingPointRange&lt;Float&gt;,&#10;    steps: Int,&#10;    onValueChange: (Float) -&gt; Unit&#10;) {&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(12.dp)&#10;    ) {&#10;        Row(&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Icon(&#10;                imageVector = icon,&#10;                contentDescription = null,&#10;                tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),&#10;                modifier = Modifier.size(24.dp)&#10;            )&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&#10;                    text = title,&#10;                    style = MaterialTheme.typography.bodyLarge,&#10;                    fontWeight = FontWeight.Medium&#10;                )&#10;                Text(&#10;                    text = subtitle,&#10;                    style = MaterialTheme.typography.bodySmall,&#10;                    color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)&#10;                )&#10;            }&#10;        }&#10;&#10;        Slider(&#10;            value = value,&#10;            onValueChange = onValueChange,&#10;            valueRange = valueRange,&#10;            steps = steps,&#10;            modifier = Modifier.padding(start = 40.dp)&#10;        )&#10;    }&#10;}&#10;&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/smartracket/com/viewmodel/SettingsViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/smartracket/com/viewmodel/SettingsViewModel.kt" />
              <option name="originalContent" value="package smartracket.com.viewmodel&#10;&#10;import android.content.Context&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.datastore.core.DataStore&#10;import androidx.datastore.preferences.core.*&#10;import androidx.datastore.preferences.preferencesDataStore&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import dagger.hilt.android.qualifiers.ApplicationContext&#10;import kotlinx.coroutines.flow.*&#10;import kotlinx.coroutines.launch&#10;import smartracket.com.db.SmartRacketDatabase&#10;import smartracket.com.model.BluetoothConnectionState&#10;import smartracket.com.model.DevicePairing&#10;import smartracket.com.repository.BluetoothRepository&#10;import smartracket.com.repository.HealthRepository&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;import javax.inject.Inject&#10;&#10;// DataStore extension&#10;private val Context.dataStore: DataStore&lt;Preferences&gt; by preferencesDataStore(name = &quot;settings&quot;)&#10;&#10;/**&#10; * ViewModel for the Settings Screen.&#10; *&#10; * Manages:&#10; * - Bluetooth device pairing&#10; * - Health Connect permissions&#10; * - App preferences&#10; * - Data management&#10; */&#10;@HiltViewModel&#10;class SettingsViewModel @Inject constructor(&#10;    @ApplicationContext private val context: Context,&#10;    private val bluetoothRepository: BluetoothRepository,&#10;    private val healthRepository: HealthRepository,&#10;    private val database: SmartRacketDatabase&#10;) : ViewModel() {&#10;&#10;    companion object {&#10;        private val AUTO_SAVE_THRESHOLD = intPreferencesKey(&quot;auto_save_threshold&quot;)&#10;        private val KEEP_SCREEN_ON = booleanPreferencesKey(&quot;keep_screen_on&quot;)&#10;        private val VIBRATION_ENABLED = booleanPreferencesKey(&quot;vibration_enabled&quot;)&#10;    }&#10;&#10;    private val dateFormatter = SimpleDateFormat(&quot;MMM dd, yyyy&quot;, Locale.getDefault())&#10;&#10;    // Bluetooth state&#10;    val connectionState: StateFlow&lt;BluetoothConnectionState&gt; = bluetoothRepository.connectionState&#10;&#10;    // Paired devices&#10;    private val _pairedDevices = MutableStateFlow&lt;List&lt;PairedDeviceUi&gt;&gt;(emptyList())&#10;    val pairedDevices: StateFlow&lt;List&lt;PairedDeviceUi&gt;&gt; = _pairedDevices.asStateFlow()&#10;&#10;    // Health Connect state&#10;    val isHealthConnectAvailable: StateFlow&lt;Boolean&gt; = healthRepository.isAvailable&#10;    val hasHealthPermissions: StateFlow&lt;Boolean&gt; = healthRepository.hasPermissions&#10;&#10;    // Settings&#10;    private val _autoSaveThreshold = MutableStateFlow(8)&#10;    val autoSaveThreshold: StateFlow&lt;Int&gt; = _autoSaveThreshold.asStateFlow()&#10;&#10;    private val _keepScreenOn = MutableStateFlow(true)&#10;    val keepScreenOn: StateFlow&lt;Boolean&gt; = _keepScreenOn.asStateFlow()&#10;&#10;    private val _vibrationEnabled = MutableStateFlow(true)&#10;    val vibrationEnabled: StateFlow&lt;Boolean&gt; = _vibrationEnabled.asStateFlow()&#10;&#10;    // Clear data dialog&#10;    private val _showClearDataDialog = MutableStateFlow(false)&#10;    val showClearDataDialog: StateFlow&lt;Boolean&gt; = _showClearDataDialog.asStateFlow()&#10;&#10;    init {&#10;        loadSettings()&#10;        loadPairedDevices()&#10;    }&#10;&#10;    private fun loadSettings() {&#10;        viewModelScope.launch {&#10;            context.dataStore.data.collect { preferences -&gt;&#10;                _autoSaveThreshold.value = preferences[AUTO_SAVE_THRESHOLD] ?: 8&#10;                _keepScreenOn.value = preferences[KEEP_SCREEN_ON] ?: true&#10;                _vibrationEnabled.value = preferences[VIBRATION_ENABLED] ?: true&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun loadPairedDevices() {&#10;        viewModelScope.launch {&#10;            database.devicePairingDao().getAllFlow().collect { devices -&gt;&#10;                _pairedDevices.value = devices.map { it.toUi() }&#10;            }&#10;        }&#10;    }&#10;&#10;    // ============= Bluetooth =============&#10;&#10;    fun startScan() {&#10;        bluetoothRepository.startScan()&#10;    }&#10;&#10;    fun stopScan() {&#10;        bluetoothRepository.stopScan()&#10;    }&#10;&#10;    fun connectToDevice(address: String) {&#10;        bluetoothRepository.connect(address)&#10;    }&#10;&#10;    fun disconnectDevice() {&#10;        bluetoothRepository.disconnect()&#10;    }&#10;&#10;    // ============= Health Connect =============&#10;&#10;    fun requestHealthPermissions() {&#10;        // In a real app, this would launch the Health Connect permission UI&#10;        viewModelScope.launch {&#10;            healthRepository.checkPermissions()&#10;        }&#10;    }&#10;&#10;    // ============= Settings =============&#10;&#10;    fun setAutoSaveThreshold(value: Int) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[AUTO_SAVE_THRESHOLD] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    fun setKeepScreenOn(value: Boolean) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[KEEP_SCREEN_ON] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    fun setVibrationEnabled(value: Boolean) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[VIBRATION_ENABLED] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    // ============= App Info =============&#10;&#10;    fun openPrivacyPolicy() {&#10;        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(&quot;https://smartracket.com/privacy&quot;)).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(intent)&#10;    }&#10;&#10;    fun openTerms() {&#10;        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(&quot;https://smartracket.com/terms&quot;)).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(intent)&#10;    }&#10;&#10;    fun sendFeedback() {&#10;        val intent = Intent(Intent.ACTION_SENDTO).apply {&#10;            data = Uri.parse(&quot;mailto:feedback@smartracket.com&quot;)&#10;            putExtra(Intent.EXTRA_SUBJECT, &quot;SmartRacket Coach Feedback&quot;)&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(Intent.createChooser(intent, &quot;Send Feedback&quot;).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        })&#10;    }&#10;&#10;    // ============= Data Management =============&#10;&#10;    fun showClearDataDialog() {&#10;        _showClearDataDialog.value = true&#10;    }&#10;&#10;    fun dismissClearDataDialog() {&#10;        _showClearDataDialog.value = false&#10;    }&#10;&#10;    fun clearAllData() {&#10;        viewModelScope.launch {&#10;            database.clearAllTables()&#10;            _showClearDataDialog.value = false&#10;        }&#10;    }&#10;&#10;    private fun DevicePairing.toUi(): PairedDeviceUi {&#10;        return PairedDeviceUi(&#10;            address = bluetoothMacAddress,&#10;            deviceName = deviceName,&#10;            lastConnectedFormatted = lastConnected?.let { dateFormatter.format(Date(it)) } ?: &quot;Never&quot;&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * UI model for paired devices.&#10; */&#10;data class PairedDeviceUi(&#10;    val address: String,&#10;    val deviceName: String,&#10;    val lastConnectedFormatted: String&#10;)&#10;&#10;" />
              <option name="updatedContent" value="package smartracket.com.viewmodel&#10;&#10;import android.content.Context&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.datastore.core.DataStore&#10;import androidx.datastore.preferences.core.*&#10;import androidx.datastore.preferences.preferencesDataStore&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import dagger.hilt.android.lifecycle.HiltViewModel&#10;import dagger.hilt.android.qualifiers.ApplicationContext&#10;import kotlinx.coroutines.flow.*&#10;import kotlinx.coroutines.launch&#10;import smartracket.com.db.SmartRacketDatabase&#10;import smartracket.com.model.BluetoothConnectionState&#10;import smartracket.com.model.DevicePairing&#10;import smartracket.com.repository.BluetoothRepository&#10;import smartracket.com.repository.HealthRepository&#10;import java.text.SimpleDateFormat&#10;import java.util.*&#10;import javax.inject.Inject&#10;&#10;// DataStore extension&#10;private val Context.dataStore: DataStore&lt;Preferences&gt; by preferencesDataStore(name = &quot;settings&quot;)&#10;&#10;/**&#10; * ViewModel for the Settings Screen.&#10; *&#10; * Manages:&#10; * - Bluetooth device pairing&#10; * - Health Connect permissions&#10; * - App preferences&#10; * - Language settings&#10; * - Data management&#10; */&#10;@HiltViewModel&#10;class SettingsViewModel @Inject constructor(&#10;    @ApplicationContext private val context: Context,&#10;    private val bluetoothRepository: BluetoothRepository,&#10;    private val healthRepository: HealthRepository,&#10;    private val database: SmartRacketDatabase&#10;) : ViewModel() {&#10;&#10;    companion object {&#10;        private val AUTO_SAVE_THRESHOLD = intPreferencesKey(&quot;auto_save_threshold&quot;)&#10;        private val KEEP_SCREEN_ON = booleanPreferencesKey(&quot;keep_screen_on&quot;)&#10;        private val VIBRATION_ENABLED = booleanPreferencesKey(&quot;vibration_enabled&quot;)&#10;        private val CHINESE_LANGUAGE = booleanPreferencesKey(&quot;chinese_language&quot;)&#10;    }&#10;&#10;    private val dateFormatter = SimpleDateFormat(&quot;MMM dd, yyyy&quot;, Locale.getDefault())&#10;&#10;    // Bluetooth state&#10;    val connectionState: StateFlow&lt;BluetoothConnectionState&gt; = bluetoothRepository.connectionState&#10;&#10;    // Paired devices&#10;    private val _pairedDevices = MutableStateFlow&lt;List&lt;PairedDeviceUi&gt;&gt;(emptyList())&#10;    val pairedDevices: StateFlow&lt;List&lt;PairedDeviceUi&gt;&gt; = _pairedDevices.asStateFlow()&#10;&#10;    // Health Connect state&#10;    val isHealthConnectAvailable: StateFlow&lt;Boolean&gt; = healthRepository.isAvailable&#10;    val hasHealthPermissions: StateFlow&lt;Boolean&gt; = healthRepository.hasPermissions&#10;&#10;    // Settings&#10;    private val _autoSaveThreshold = MutableStateFlow(8)&#10;    val autoSaveThreshold: StateFlow&lt;Int&gt; = _autoSaveThreshold.asStateFlow()&#10;&#10;    private val _keepScreenOn = MutableStateFlow(true)&#10;    val keepScreenOn: StateFlow&lt;Boolean&gt; = _keepScreenOn.asStateFlow()&#10;&#10;    private val _vibrationEnabled = MutableStateFlow(true)&#10;    val vibrationEnabled: StateFlow&lt;Boolean&gt; = _vibrationEnabled.asStateFlow()&#10;&#10;    // Language settings&#10;    private val _isChineseLanguage = MutableStateFlow(false)&#10;    val isChineseLanguage: StateFlow&lt;Boolean&gt; = _isChineseLanguage.asStateFlow()&#10;&#10;    // Clear data dialog&#10;    private val _showClearDataDialog = MutableStateFlow(false)&#10;    val showClearDataDialog: StateFlow&lt;Boolean&gt; = _showClearDataDialog.asStateFlow()&#10;&#10;    init {&#10;        loadSettings()&#10;        loadPairedDevices()&#10;    }&#10;&#10;    private fun loadSettings() {&#10;        viewModelScope.launch {&#10;            context.dataStore.data.collect { preferences -&gt;&#10;                _autoSaveThreshold.value = preferences[AUTO_SAVE_THRESHOLD] ?: 8&#10;                _keepScreenOn.value = preferences[KEEP_SCREEN_ON] ?: true&#10;                _vibrationEnabled.value = preferences[VIBRATION_ENABLED] ?: true&#10;                _isChineseLanguage.value = preferences[CHINESE_LANGUAGE] ?: false&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun loadPairedDevices() {&#10;        viewModelScope.launch {&#10;            database.devicePairingDao().getAllFlow().collect { devices -&gt;&#10;                _pairedDevices.value = devices.map { it.toUi() }&#10;            }&#10;        }&#10;    }&#10;&#10;    // ============= Bluetooth =============&#10;&#10;    fun startScan() {&#10;        bluetoothRepository.startScan()&#10;    }&#10;&#10;    fun stopScan() {&#10;        bluetoothRepository.stopScan()&#10;    }&#10;&#10;    fun connectToDevice(address: String) {&#10;        bluetoothRepository.connect(address)&#10;    }&#10;&#10;    fun disconnectDevice() {&#10;        bluetoothRepository.disconnect()&#10;    }&#10;&#10;    // ============= Health Connect =============&#10;&#10;    fun requestHealthPermissions() {&#10;        // In a real app, this would launch the Health Connect permission UI&#10;        viewModelScope.launch {&#10;            healthRepository.checkPermissions()&#10;        }&#10;    }&#10;&#10;    // ============= Settings =============&#10;&#10;    fun setAutoSaveThreshold(value: Int) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[AUTO_SAVE_THRESHOLD] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    fun setKeepScreenOn(value: Boolean) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[KEEP_SCREEN_ON] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    fun setVibrationEnabled(value: Boolean) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[VIBRATION_ENABLED] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    fun setChineseLanguage(value: Boolean) {&#10;        viewModelScope.launch {&#10;            context.dataStore.edit { preferences -&gt;&#10;                preferences[CHINESE_LANGUAGE] = value&#10;            }&#10;        }&#10;    }&#10;&#10;    // ============= App Info =============&#10;&#10;    fun openPrivacyPolicy() {&#10;        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(&quot;https://smartracket.com/privacy&quot;)).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(intent)&#10;    }&#10;&#10;    fun openTerms() {&#10;        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(&quot;https://smartracket.com/terms&quot;)).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(intent)&#10;    }&#10;&#10;    fun sendFeedback() {&#10;        val intent = Intent(Intent.ACTION_SENDTO).apply {&#10;            data = Uri.parse(&quot;mailto:feedback@smartracket.com&quot;)&#10;            putExtra(Intent.EXTRA_SUBJECT, &quot;SmartRacket Coach Feedback&quot;)&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        }&#10;        context.startActivity(Intent.createChooser(intent, &quot;Send Feedback&quot;).apply {&#10;            flags = Intent.FLAG_ACTIVITY_NEW_TASK&#10;        })&#10;    }&#10;&#10;    // ============= Data Management =============&#10;&#10;    fun showClearDataDialog() {&#10;        _showClearDataDialog.value = true&#10;    }&#10;&#10;    fun dismissClearDataDialog() {&#10;        _showClearDataDialog.value = false&#10;    }&#10;&#10;    fun clearAllData() {&#10;        viewModelScope.launch {&#10;            database.clearAllTables()&#10;            _showClearDataDialog.value = false&#10;        }&#10;    }&#10;&#10;    private fun DevicePairing.toUi(): PairedDeviceUi {&#10;        return PairedDeviceUi(&#10;            address = bluetoothMacAddress,&#10;            deviceName = deviceName,&#10;            lastConnectedFormatted = lastConnected?.let { dateFormatter.format(Date(it)) } ?: &quot;Never&quot;&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * UI model for paired devices.&#10; */&#10;data class PairedDeviceUi(&#10;    val address: String,&#10;    val deviceName: String,&#10;    val lastConnectedFormatted: String&#10;)&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>